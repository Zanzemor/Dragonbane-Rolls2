<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Rolador com Hist√≥rico</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            padding: 200px 10px 10px; /* Espa√ßo para o cabe√ßalho fixo */
        }

        .header-fixo {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: white;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .botao {
            background-color: #1877f2;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            margin: 5px;
            cursor: pointer;
        }

        .historico {
            background-color: white;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .bloqueado {
            background-color: #ffcccc !important;
            cursor: not-allowed !important;
        }

        .rolagem-item {
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }

        #avisos {
            color: #ff0000;
            font-weight: bold;
            margin: 10px 0;
        }

        .share-btn {
            background-color: #25D366 !important;
        }

        .input-group {
            margin: 10px 0;
        }

        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="header-fixo">
        <div class="container">
            <div class="input-group">
                <input type="text" id="playerName" placeholder="Digite seu nome">
            </div>
            
            <div id="contador"></div>
            
            <div style="display: flex; gap: 5px;">
                <button class="botao" onclick="rolar4d6()" id="rolarBtn">
                    üé≤ Rolar 4d6
                </button>
                
                <button class="botao share-btn" onclick="compartilharHistorico()">
                    üì§ Compartilhar
                </button>
            </div>

            <div id="avisos"></div>
            
            <div id="senhaContainer" class="senha-container">
                <input type="password" id="senhaInput" placeholder="Senha de desbloqueio">
                <button class="botao" onclick="desbloquearNome()">üîì Desbloquear</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="historico">
            <h3>Hist√≥rico de Rolagens</h3>
            <div id="ultimasRolagens"></div>
        </div>
    </div>

    <script>
        const SENHA_DESBLOQUEIO = "joaod";
        let contadorRolagens = {};
        let historico = {};
        let nomesBloqueados = new Set();

        function atualizarInterface() {
            const nome = document.getElementById('playerName').value.trim().toLowerCase();
            const contador = contadorRolagens[nome] || 0;
            
            document.getElementById('contador').innerHTML = `
                Rolagens restantes: <strong>${7 - contador}</strong>
            `;

            document.getElementById('senhaContainer').style.display = 
                nomesBloqueados.has(nome) ? 'block' : 'none';

            document.getElementById('ultimasRolagens').innerHTML = 
                Object.keys(historico).map(nome => 
                    historico[nome].map(roll => `
                        <div class="rolagem-item">
                            <strong>${nome}</strong> - ${roll.data}<br>
                            ${roll.resultado.replace(/\n/g, '<br>')}
                        </div>
                    `).join('')
                ).join('') || "Nenhuma rolagem registrada";
        }

        function compartilharHistorico() {
            const historicoTexto = Object.keys(historico).map(nome => 
                `*Jogador: ${nome}*\n` +
                historico[nome].map(roll => 
                    `${roll.data}\n${roll.resultado}`
                ).join('\n\n')
            ).join('\n\n');

            const texto = encodeURIComponent(
                `*Hist√≥rico de Rolagens*\n\n${historicoTexto}\n\n` +
                `Total de rolagens: ${Object.values(historico).flat().length}\n` +
                `üéÆ Rolador RPG - ${new Date().toLocaleDateString()}`
            );

            window.open(`https://wa.me/?text=${texto}`);
        }

        // Mantidas as fun√ß√µes anteriores (verificarBloqueio, desbloquearNome, rolar4d6)
        function verificarBloqueio(nome) {
            if(nomesBloqueados.has(nome)) {
                document.getElementById('avisos').innerHTML = "‚õî Nome bloqueado!";
                document.getElementById('rolarBtn').classList.add('bloqueado');
                return true;
            }
            return false;
        }

        function desbloquearNome() {
            const nome = document.getElementById('playerName').value.trim().toLowerCase();
            const senha = document.getElementById('senhaInput').value;

            if(senha === SENHA_DESBLOQUEIO) {
                nomesBloqueados.delete(nome);
                contadorRolagens[nome] = 0;
                document.getElementById('senhaInput').value = '';
                document.getElementById('avisos').innerHTML = "üîì Nome desbloqueado!";
                document.getElementById('rolarBtn').classList.remove('bloqueado');
                atualizarInterface();
            } else {
                document.getElementById('avisos').innerHTML = "‚ùå Senha incorreta!";
            }
        }

        function rolar4d6() {
            const nome = document.getElementById('playerName').value.trim().toLowerCase();
            
            if(!nome) {
                document.getElementById('avisos').innerHTML = "‚ö†Ô∏è Digite um nome v√°lido!";
                return;
            }

            if(verificarBloqueio(nome)) return;

            if((contadorRolagens[nome] || 0) >= 7) {
                nomesBloqueados.add(nome);
                document.getElementById('avisos').innerHTML = "‚õî Limite de 7 rolagens!";
                document.getElementById('rolarBtn').classList.add('bloqueado');
                return;
            }

            const dados = Array.from({length: 4}, () => Math.floor(Math.random() * 6) + 1);
            const sorted = [...dados].sort((a, b) => b - a);
            const total = sorted.slice(0, 3).reduce((a, b) => a + b, 0);
            
            const resultado = {
                data: new Date().toLocaleString(),
                resultado: `üé≤ Dados: ${dados.join(', ')}\n‚úÖ Mantidos: ${sorted.slice(0, 3).join(', ')}\n‚ùå Descartado: ${sorted[3]}\nüíØ Total: ${total}`
            };

            contadorRolagens[nome] = (contadorRolagens[nome] || 0) + 1;
            historico[nome] = [...(historico[nome] || []), resultado];
            
            atualizarInterface();
            document.getElementById('avisos').innerHTML = "";
        }

        document.getElementById('playerName').addEventListener('input', function() {
            document.getElementById('rolarBtn').classList.remove('bloqueado');
            document.getElementById('avisos').innerHTML = "";
            atualizarInterface();
        });

        atualizarInterface();
    </script>
</body>
</html>